<!DOCTYPE html>
<html>
<head>
  <title>IRC Chat Client</title>
  <style>
    body { font-family: sans-serif; background: #121212; color: #e0e0e0; margin: 20px; }
    input, textarea { background: #1e1e2e; color: white; border: 1px solid #444; border-radius: 6px; padding: 8px; }
    textarea { width: 100%; box-sizing: border-box; margin-bottom: 10px; }
    input { width: calc(100% - 120px); margin-right: 10px; }
    .btn { padding: 8px 12px; margin: 4px 4px 4px 0; background: #33334d; color: white; border: none; border-radius: 6px; cursor: pointer; }
    .btn:hover { background: #4a4a6f; }
  </style>
</head>
<body>
  <h1>IRC Client</h1>

  <label>Nickname: <input id="nickname" placeholder="Your nickname" /></label><br><br>
  <h3>Step 1: Generate Offer</h3>
  <button class="btn" onclick="makeOffer()">Generate Offer</button>
  <textarea id="offerOutput" rows="10" readonly></textarea>

  <h3>Step 2: Paste Server Answer</h3>
  <textarea id="answerInput" rows="10" placeholder="Paste server answer here"></textarea><br>
  <button class="btn" onclick="connect()">Connect</button>

  <h3>Chat</h3>
  <textarea id="chat" rows="15" readonly></textarea><br>
  <input id="msg" placeholder="Message..." />
  <button class="btn" onclick="send()">Send</button>
  <button class="btn" onclick="disconnect()">Disconnect</button>

  <script>
    let pc, dc;

    async function makeOffer() {
      pc = new RTCPeerConnection({ iceServers: [{ urls: "stun:stun.l.google.com:19302" }] });
      dc = pc.createDataChannel("chat");

      dc.onmessage = e => {
        const chatBox = document.getElementById("chat");
        chatBox.value += e.data + "\n";
        chatBox.scrollTop = chatBox.scrollHeight;
      };

      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      const iceCandidates = [];
      pc.onicecandidate = e => {
        if (e.candidate) {
          iceCandidates.push(e.candidate);
        } else {
          document.getElementById('offerOutput').value = JSON.stringify({ offer: pc.localDescription, ice: iceCandidates }, null, 2);
        }
      };
    }

    async function connect() {
      const data = JSON.parse(document.getElementById('answerInput').value);
      await pc.setRemoteDescription(new RTCSessionDescription(data.answer));
      for (const c of data.ice) {
        await pc.addIceCandidate(new RTCIceCandidate(c));
      }
    }

    function send() {
      const msgBox = document.getElementById("msg");
      const nickname = document.getElementById("nickname").value || "Anonymous";
      const message = nickname + ": " + msgBox.value;
      dc.send(message);
      msgBox.value = "";
    }

    function disconnect() {
      if (dc) dc.close();
      if (pc) pc.close();
      const chatBox = document.getElementById("chat");
      chatBox.value += "\nDisconnected.";
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  </script>
</body>
</html>
