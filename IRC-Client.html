<!DOCTYPE html>
<html>
<head><title>IRC Client</title></head>
<body>
  <h1>IRC Client</h1>
  <label>Nickname: <input id="nickname" placeholder="Your nickname" /></label><br><br>
  <h3>Step 1: Generate Offer</h3>
  <button onclick="makeOffer()">Generate Offer</button>
  <textarea id="offerOutput" rows="10" cols="70" readonly></textarea>
  <h3>Step 2: Paste Server Answer</h3>
  <textarea id="answerInput" rows="10" cols="70" placeholder="Paste server answer here"></textarea><br>
  <button onclick="connect()">Connect</button>
  <h3>Chat</h3>
  <textarea id="chat" rows="15" cols="70" readonly></textarea><br>
  <input id="msg" placeholder="Message..." />
  <button onclick="send()">Send</button>
  <button onclick="disconnect()">Disconnect</button>
  <script>
    let pc, dc;
    async function makeOffer() {
      pc = new RTCPeerConnection({ iceServers: [{ urls: "stun:stun.l.google.com:19302" }] });
      dc = pc.createDataChannel("chat");
      dc.onmessage = e => {
        document.getElementById("chat").value += "\n" + e.data;
      };
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      const iceCandidates = [];
      pc.onicecandidate = e => {
        if (e.candidate) {
          iceCandidates.push(e.candidate);
        } else {
          document.getElementById('offerOutput').value = JSON.stringify({
            offer: pc.localDescription,
            ice: iceCandidates
          }, null, 2);
        }
      };
    }
    async function connect() {
      const data = JSON.parse(document.getElementById('answerInput').value);
      await pc.setRemoteDescription(new RTCSessionDescription(data.answer));
      for (const c of data.ice) {
        await pc.addIceCandidate(new RTCIceCandidate(c));
      }
    }
    function send() {
      const msgBox = document.getElementById("msg");
      const nickname = document.getElementById("nickname").value || "Anonymous";
      const message = nickname + ": " + msgBox.value;
      dc.send(message);
      msgBox.value = "";
    }
    function disconnect() {
      if (dc) dc.close();
      if (pc) pc.close();
      document.getElementById("chat").value += "\nDisconnected.";
    }
  </script>
</body>
</html>
